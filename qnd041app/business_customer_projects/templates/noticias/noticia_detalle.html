{% extends "base.html" %}
{% load static %}

{% block content %}


<style>
  #commentFormWrapper {
    animation: fadeSlide .3s ease-in-out;
  }

  @keyframes fadeSlide {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>




<div class="page-content-wrapper">
  <div class="page-content">

    <!-- Breadcrumb -->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
      <div class="breadcrumb-title pe-3">
       SmartQuail ® E-Books
      </div>
      <div class="ps-3">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-0 p-0 align-items-center">

                <li class="breadcrumb-item active" aria-current="page">{{ noticia.categoria }}</li>
              </ol>
            </nav>
          </div>

    </div>

    <!-- Nav pills -->


    
    <!-- Tab content -->
    <div class="tab-content">
      <div class="tab-pane fade show active" id="tab-orderlist" role="tabpanel">
        <hr class="my-4">
        <div class="card radius-10" style="background-color: #2e2e2e;">
          <div class="card-body" style="background-color: #2e2e2e;">

<div class="row">
              <div class="col-12 col-lg-8 col-xl-9">
<div class="card overflow-hidden radius-10" style="background-color: #2e2e2e;">

  <!-- COVER -->
  <div class="profile-cover position-relative mb-4"
       style="
        background-image: url('{% if noticia.imagen_portada %}{{ noticia.imagen_portada.url }}{% endif %}');
        background-size: cover;
        background-position: center;
        height: 280px;
       ">

    <!-- GRADIENTE (opcional pero recomendado) -->
    <div class="position-absolute top-0 start-0 w-100 h-100"
         style="background: linear-gradient(90deg, rgba(0,0,0,.6), rgba(0,0,0,.15));">
    </div>

    <!-- TÍTULO -->
<div class="position-absolute top-50 start-0 translate-middle-y ps-4 pe-4 text-white"
     style="max-width: 75%;">

  <h3 class="fw-bold mb-2">
    {{ noticia.titulo_1 }}
  </h3>

  {% if noticia.subtitulo_1 %}
    <p class="fw-normal mb-0 opacity-75">
      {{ noticia.subtitulo_1 }}
    </p>
  {% endif %}

</div>


  </div>

  <!-- CUERPO -->
  <div class="card-body" style="background-color: #2e2e2e;">
    <div class="d-flex align-items-start justify-content-between">

      <div>
        <!-- No repetir el título aquí -->

  {% if noticia.autor_foto %}
    <img src="{{ noticia.autor_foto.url }}"
         width="65"
         height="65"
         class="rounded-circle"
         alt="{{ noticia.autor_nombre }}">
  {% else %}
    <img src="{% static 'assets/images/avatars/05.png' %}"
         width="65"
         height="65"
         class="rounded-circle"
         alt="Autor">
  {% endif %}



  

        <p class="mb-0 text-muted" style="font-size: 12px;margin-top: 0px;">
         {{ noticia.autor_nombre }}
        </p>
        <p class="mb-0 text-muted" style="font-size: 12px;margin-top: -7px;">
         <strong>Chief Officer Technologies</strong>
        </p>

                <p class="mb-0 text-muted" style="font-size: 12px;margin-top: -7px;">
          SmartQuail,Inc
        </p>
                       <p class="mb-0 text-muted" style="font-size: 10px;margin-top: -7px;">
          Todos los derechos reservados ® 2026
        </p>

        <div class="mt-2">
          <span class="badge rounded-pill bg-primary">UX Research</span>
          <span class="badge rounded-pill bg-primary">CX Strategy</span>
          <span class="badge rounded-pill bg-primary">Project Management</span>
        </div>
      </div>

    </div>
  </div>

</div>

                <div class="card" style="background-color: #2e2e2e;">
                  <div class="card-body">
               
                    <p class="">It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters.</p>
                    <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
                    <p>It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters</p>
   


                </div>

                <div class="card-body">

                <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  <div class="carousel-item">
                    <img src="{% static 'assets/images/carousel/01.jpg' %}" class="d-block w-100" alt="...">
                  </div>
                  <div class="carousel-item">
                    <img src="{% static 'assets/images/carousel/02.jpg' %}" class="d-block w-100" alt="...">
                  </div>
                  <div class="carousel-item active">
                    <img src="{% static 'assets/images/carousel/03.jpg' %}" class="d-block w-100" alt="...">
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>

                </div>
                <div class="card-body">

                                  <h4 class="mb-2">About Me</h4>
                    <p class="">It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters.</p>
                    <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
                    <p>It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters</p>

                </div>

                



                </div>
                 <div class="card-body">
                    <div class="rates fs-6 mb-2">	


    <div class="rates cursor-pointer fs-6 mb-2">  

  <ion-icon class="rate-action" 
   name="heart-outline" 
            data-action="like" 
  data-action="like" data-noticia-id="{{ noticia.id }}"></ion-icon>
<span id="likes-count-{{ noticia.id }}">{{ noticia.metricas.likes }}</span>

  <!-- COMENTARIOS -->
  <ion-icon id="toggleCommentForm"
            name="chatbubble-outline"
            style="cursor:pointer;">
  </ion-icon>
  {{ noticia.comentarios.count }}

<ion-icon class="rate-action" 
            name="git-compare-outline" 
            data-action="share_social"
data-action="share_social" data-noticia-id="{{ noticia.id }}"></ion-icon>
<span id="shares-count-{{ noticia.id }}">{{ noticia.metricas.compartidos_redes }}</span>

<ion-icon class="rate-action" 
            name="send-outline" 
            data-action="share_email" 
data-action="share_email" data-noticia-id="{{ noticia.id }}"></ion-icon>
<span id="email-count-{{ noticia.id }}">{{ noticia.metricas.compartidos_email }}</span>



</div>



</div>



<div id="commentFormWrapper" class="mt-3" style="display:none;">
  <form method="post" action="">
    {% csrf_token %}

    <div class="d-flex align-items-start gap-3">
      <!-- Avatar usuario -->
<img src="
  {% if request.user.profile.photo %}
    {{ request.user.profile.photo.url }}
  {% else %}
    {% static 'assets/images/avatars/05.png' %}
  {% endif %}
"
width="45"
height="45"
class="rounded-circle"
alt="{{ request.user.get_full_name|default:request.user.username }}">

      <div class="flex-grow-1">
        <textarea name="comentario"
                  class="form-control"
                  rows="3"
                  placeholder="Escribe tu comentario..."
                  required></textarea>

        <div class="text-end mt-2">
          <button type="submit" class="btn btn-warning btn-sm">
            Comentar
          </button>
        </div>
      </div>
    </div>

  </form>
</div>
<div class="product-review">
  <h5 class="mb-4">
    Comentarios
  </h5>

  <div class="review-list">

    {% for comentario in noticia.comentarios.all %}
      {% if comentario.activo %}
      <div class="d-flex align-items-start mb-4">

        <!-- USUARIO -->
        <div class="review-user">
          <img src="
            {% if comentario.usuario.profile.photo %}
              {{ comentario.usuario.profile.photo.url }}
            {% else %}
              {% static 'assets/images/avatars/05.png' %}
            {% endif %}
          "
          width="65"
          height="65"
          class="rounded-circle"
          alt="{{ comentario.usuario.username }}">
        </div>

        <!-- CONTENIDO -->
        <div class="review-content ms-3 w-100">
          <div class="d-flex align-items-center mb-2">
            <h6 class="mb-0">
              {{ comentario.usuario.get_full_name|default:comentario.usuario.username }}
            </h6>
            <p class="mb-0 ms-auto text-muted">
              {{ comentario.fecha_creacion|date:"d M Y" }}
            </p>
          </div>

          <p>
            {{ comentario.comentario }}
          </p>
        </div>

      </div>
      <hr>
      {% endif %}
    {% empty %}
      <p class="text-muted">No hay comentarios aún.</p>
    {% endfor %}

  </div>
</div>

                </div>

                                
 
                    
              </div>
              <div class="col-12 col-lg-4 col-xl-3">



                <div class="card radius-10">
                  <div class="card-body">
                
                     <div class="mb-3">
                        <p class="mb-1">Publicación: {{ noticia.fecha_publicacion|date:"d M Y" }}</p>
                      <p class="mb-1">Dificultad: Nivel Básico</p>
                      <div class="progress" style="height: 5px;">
                       <div class="progress-bar" role="progressbar" style="width: 45%"></div>
                      </div>
                     </div>


                  </div>
                </div>

          


                <div class="card radius-10">
                  <div class="card-body">
                     <p class=""><ion-icon name="globe-sharp" class="me-2 md hydrated" role="img" aria-label="globe sharp"></ion-icon>www.example.com</p>
                     <p class=""><ion-icon name="logo-facebook" class="me-2 md hydrated" role="img" aria-label="logo facebook"></ion-icon>Facebook</p>
                     <p class=""><ion-icon name="logo-twitter" class="me-2 md hydrated" role="img" aria-label="logo twitter"></ion-icon>Twitter</p>
                     <p class="mb-0"><ion-icon name="logo-linkedin" class="me-2 md hydrated" role="img" aria-label="logo linkedin"></ion-icon>LinkedIn</p>
                  </div>
                </div>


                                <div class="card radius-10">
                  
                            

                </div>

              

              </div>
            </div>


          </div>
        </div>
      </div>
    </div>

  </div>
</div>



<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleBtn = document.getElementById('toggleCommentForm');
    const formWrapper = document.getElementById('commentFormWrapper');

    toggleBtn.addEventListener('click', function () {
      if (formWrapper.style.display === 'none' || formWrapper.style.display === '') {
        formWrapper.style.display = 'block';
        formWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        formWrapper.style.display = 'none';
      }
    });
  });
</script>


<script>
document.addEventListener('DOMContentLoaded', function () {

  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  document.querySelectorAll('.rate-action').forEach(icon => {
    icon.addEventListener('click', function () {

      const action = this.dataset.action;
      const noticiaId = this.dataset.noticiaId;

      // Genera la URL usando template tag
      const url = `{% url 'business_customer_projects:actualizar_metricas' 0 %}`.replace('0', noticiaId);

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken
        },
        body: JSON.stringify({ action })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {

          if (action === 'like') {
            document.getElementById(`likes-count-${noticiaId}`).innerText = data.likes;
          }

          if (action === 'share_social') {
            document.getElementById(`shares-count-${noticiaId}`).innerText = data.compartidos_redes;
          }

          if (action === 'share_email') {
            document.getElementById(`email-count-${noticiaId}`).innerText = data.compartidos_email;
          }

        } else {
          alert(data.error || 'Error al procesar la acción');
        }
      });

    });
  });

});
</script>


{% endblock %}



