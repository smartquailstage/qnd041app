{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}

<div class="page-content-wrapper">
  <!-- start page content-->
  <div class="page-content">

<!-- Nav pills -->
<ul class="nav nav-pills mb-3" id="custom-tabs" role="tablist">
  <li class="nav-item" role="presentation">
    <a class="nav-link active" data-bs-toggle="pill" href="#tab-general" role="tab" aria-selected="true">
      <div class="d-flex align-items-center">
        <div class="tab-icon"><i class="bx bx-folder font-18 me-1"></i></div>
        <div class="tab-title">{{ project.name }}</div>
      </div>
    </a>
  </li>

  <li class="nav-item" role="presentation">
    <a class="nav-link" data-bs-toggle="pill" href="#tab-desarrollo" role="tab" aria-selected="false">
      <div class="d-flex align-items-center">
        <div class="tab-icon"><i class="bx bx-cog font-18 me-1"></i></div>
        <div class="tab-title">Desarrollo e Investigación</div>
      </div>
    </a>
  </li>

  {% if has_automation %}
  <li class="nav-item" role="presentation">
    <a class="nav-link" data-bs-toggle="pill" href="#tab-automatizacion" role="tab" aria-selected="false">
      <div class="d-flex align-items-center">
        <div class="tab-icon"><i class="bx bx-bot font-18 me-1"></i></div>
        <div class="tab-title">Automatización</div>
      </div>
    </a>
  </li>
  {% endif %}

  {% if has_ai %}
  <li class="nav-item" role="presentation">
    <a class="nav-link" data-bs-toggle="pill" href="#tab-ia" role="tab" aria-selected="false">
      <div class="d-flex align-items-center">
        <div class="tab-icon"><i class="bx bx-brain font-18 me-1"></i></div>
        <div class="tab-title">Inteligencia Artificial</div>
      </div>
    </a>
  </li>
  {% endif %}

  <li class="nav-item" role="presentation">
    <a class="nav-link" data-bs-toggle="pill" href="#tab-recursos" role="tab" aria-selected="false">
      <div class="d-flex align-items-center">
        <div class="tab-icon"><i class="bx bx-bar-chart font-18 me-1"></i></div>
        <div class="tab-title">Recursos y Facturación</div>
      </div>
    </a>
  </li>
</ul>


    <div class="tab-content">

      <!-- TAB 1: Información General del Proyecto -->
      <div class="tab-pane fade show active" id="tab-general" role="tabpanel">
        <div class="card radius-10">
          <div class="card-body">
            <h3>{{ project.name }}</h3>
            <p><strong>Descripción:</strong> {{ project.description }}</p>
            <p><strong>Fecha de Creación:</strong> {{ project.created_at|date:"d/m/Y H:i" }}</p>

            <hr class="my-4">

            <h4>Personal a Cargo</h4>

             <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-3 row-cols-xxl-3">
                <div class="col">
                  <div class="card radius-10">
                    <div class="card-body text-center">
                      <div class="profile-img">
                         <img src="assets/images/avatars/01.png" class="rounded-circle" width="120" height="120" alt="">
                      </div>
                      <div class="mt-4">
                          <h5 class="mb-1">Ryan Septimus</h5>
                          <p class="mb-0">@ryna_septimus</p>
                      </div>
                      <div class="d-flex align-items-center justify-content-around mt-4">
                        <div class="">
                          <h4 class="mb-0">289</h4>
                          <p class="mb-0">Posts</p>
                        </div>
                        <div class="">
                          <h4 class="mb-0">42K</h4>
                          <p class="mb-0">Followers</p>
                        </div>
                        <div class="">
                          <h4 class="mb-0">8K</h4>
                          <p class="mb-0">Following</p>
                        </div>
                     </div>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="card radius-10">
                    <div class="card-body text-center">
                      <div class="profile-img">
                         <img src="assets/images/avatars/02.png" class="rounded-circle" width="120" height="120" alt="">
                      </div>
                      <div class="mt-4">
                          <h5 class="mb-1">Ryan Septimus</h5>
                          <p class="mb-0">@ryna_septimus</p>
                      </div>
                      <div class="d-flex align-items-center justify-content-around mt-4">
                        <div class="">
                          <h4 class="mb-0">289</h4>
                          <p class="mb-0">Posts</p>
                        </div>
                        <div class="">
                          <h4 class="mb-0">42K</h4>
                          <p class="mb-0">Followers</p>
                        </div>
                        <div class="">
                          <h4 class="mb-0">8K</h4>
                          <p class="mb-0">Following</p>
                        </div>
                    </div>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="card radius-10">
                    <div class="card-body text-center">
                      <div class="profile-img">
                         <img src="assets/images/avatars/03.png" class="rounded-circle" width="120" height="120" alt="">
                      </div>
                      <div class="mt-4">
                          <h5 class="mb-1">Ryan Septimus</h5>
                          <p class="mb-0">@ryna_septimus</p>
                      </div>
                      <div class="d-flex align-items-center justify-content-around mt-4">
                          <div class="">
                            <h4 class="mb-0">289</h4>
                            <p class="mb-0">Posts</p>
                          </div>
                          <div class="">
                            <h4 class="mb-0">42K</h4>
                            <p class="mb-0">Followers</p>
                          </div>
                          <div class="">
                            <h4 class="mb-0">8K</h4>
                            <p class="mb-0">Following</p>
                          </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            {% if staff %}
              <ul class="list-group">
              {% for person in staff %}
                <li class="list-group-item">
                  <strong>{{ person.name }}</strong> – {{ person.role }}
                  <br><small>Email: {{ person.email }}</small>
                </li>
              {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted">No hay personal asignado al proyecto.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- TAB 2: Desarrollo e Investigación -->
      <div class="tab-pane fade" id="tab-desarrollo" role="tabpanel">
        <div class="card radius-10">
          <div class="card-body">
            <h4 class="mb-3">Procesos del Proyecto</h4>
            {% for process in processes %}
            <div class="card mb-3 border">
              <div class="card-body">
                <h5>{{ process.name }}</h5>
                <p>{{ process.description }}</p>
                <p><strong>Progreso:</strong> {{ process.progress }}%</p>
                <p><strong>Automatización:</strong> {{ process.has_automation|yesno:"Sí,No" }}</p>
                {% if process.has_automation %}
                <p><strong>Descripción de Automatización:</strong> {{ process.automation_description }}</p>
                {% endif %}
                <p><strong>¿Usa IA?:</strong> {{ process.has_ai|yesno:"Sí,No" }}</p>
                {% if process.has_ai %}
                <p><strong>Modelo IA:</strong> {{ process.ai_model_description }}</p>
                {% endif %}

                <hr>
                <h6>Tests QA</h6>
                {% if process.qa_tests.exists %}
                <ul class="list-group list-group-flush">
                  {% for test in process.qa_tests.all %}
                  <li class="list-group-item">
                    <strong>{{ test.test_case }}</strong> - <span class="badge 
                      {% if test.result == 'passed' %} bg-success 
                      {% elif test.result == 'failed' %} bg-danger 
                      {% else %} bg-warning text-dark 
                      {% endif %}">
                      {{ test.get_result_display }}
                    </span><br>
                    <small>{{ test.description }}</small><br>
                    <small>Ejecutado por {{ test.executed_by }} el {{ test.executed_at|date:"d/m/Y H:i" }}</small>
                  </li>
                  {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted">No hay pruebas QA registradas.</p>
                {% endif %}
              </div>
            </div>
            {% empty %}
            <p>No hay procesos definidos para este proyecto.</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- TAB 3: Recursos y Facturación -->
      <div class="tab-pane fade" id="tab-recursos" role="tabpanel">
        <div class="card radius-10">
          <div class="card-body">
            <h4 class="mb-3">Recursos Cloud</h4>
            {% for resource in cloud_resources %}
            <div class="card mb-3 border">
              <div class="card-body">
                <h5>{{ resource.resource_name }} ({{ resource.provider }})</h5>
                <p><strong>Tipo:</strong> {{ resource.get_resource_type_display }}</p>
                <p><strong>Costo Mensual:</strong> ${{ resource.monthly_cost_usd }}</p>
                <p><strong>Monitoreo:</strong> {{ resource.monitoring_tool|default:"No especificado" }}</p>
                <p><strong>Estado:</strong> 
                  <span class="badge 
                    {% if resource.monitoring_status == 'healthy' %} bg-success 
                    {% elif resource.monitoring_status == 'warning' %} bg-warning text-dark 
                    {% else %} bg-danger 
                    {% endif %}">
                    {{ resource.get_monitoring_status_display }}
                  </span>
                </p>
                {% if resource.alert_summary %}
                <p><strong>Alertas:</strong> {{ resource.alert_summary }}</p>
                {% endif %}
              </div>
            </div>
            {% empty %}
            <p>No hay recursos cloud asignados a este proyecto.</p>
            {% endfor %}
          </div>
        </div>
      </div>
{% if has_automation %}
<div class="tab-pane fade" id="tab-automatizacion" role="tabpanel">
  <div class="card radius-10">
    <div class="card-body">
      <h4>Procesos con Automatización</h4>
      {% for process in processes %}
        {% if process.has_automation %}
        <div class="card mb-3 border">
          <div class="card-body">
            <h5>{{ process.name }}</h5>
            <p><strong>Descripción:</strong> {{ process.description }}</p>
            <p><strong>Automatización:</strong> {{ process.automation_description }}</p>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

{% if has_ai %}
<div class="tab-pane fade" id="tab-ia" role="tabpanel">
  <div class="card radius-10">
    <div class="card-body">
      <h4>Procesos con Inteligencia Artificial</h4>
      {% for process in processes %}
        {% if process.has_ai %}
        <div class="card mb-3 border">
          <div class="card-body">
            <h5>{{ process.name }}</h5>
            <p><strong>Descripción:</strong> {{ process.description }}</p>
            <p><strong>Modelo IA:</strong> {{ process.ai_model_description }}</p>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}






    </div> <!-- end tab content -->

  </div> <!-- end page content -->
</div>

{% endblock %}
