{% load widget_tweaks %}
{% load static %}


<div class="tab-pane fade" id="tab-ia" role="tabpanel">
  <hr class="my-4">
  <div class="card radius-10">
    <div class="card-body">
      <div class="row">

        <!-- BLOQUE PRINCIPAL -->
        <div class="col-12 col-xl-8 d-flex">
          <div class="card radius-10 w-100">
            <div class="card-body" style="background-color: rgb(46, 46, 46); border-radius: 25px;">

              <h5>
                <ion-icon name="hardware-chip-outline"></ion-icon>
                Inteligencia Artificial y Agentes en: {{ project.name }}
              </h5>

              <!-- KPI -->
              <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between border p-3 gap-3 mb-0 rounded-3">
                <div class="d-flex align-items-center gap-3">
                  <div class="widget-icon rounded-circle bg-light-success text-success">
                    <ion-icon name="layers-outline"></ion-icon>
                  </div>
                  <div class="">
                    <h4 class="mb-0">{{ total_intelligents }}</h4>
                    <p class="mb-0 text-secondary">Total Modelos AI</p>
                  </div>
                </div>
                <div class="vr d-none d-lg-block"></div>
                <div class="d-flex align-items-center gap-3">
                  <div class="widget-icon rounded-circle bg-light-info text-info">
                    <ion-icon name="pulse-outline"></ion-icon>
                  </div>
                  <div class="">
                    <h4 class="mb-0">{{ completed_intelligents }}</h4>
                    <p class="mb-0 text-secondary">Completados</p>
                  </div>
                </div>
                <div class="vr d-none d-lg-block"></div>
                <div class="d-flex align-items-center gap-3">
                  <div class="widget-icon rounded-circle bg-light-warning text-warning">
                    <ion-icon name="cog-outline"></ion-icon>
                  </div>
                  <div class="">
                    <h4 class="mb-0">{{ total_intelligents|add:"-"|add:completed_intelligents }}</h4>
                    <p class="mb-0 text-secondary">En progreso</p>
                  </div>
                </div>
              </div>

              <!-- LISTADO DETALLADO -->
              <div class="row g-4 align-items-center mt-4">
                <div class="col-12" style="max-height: 300px; overflow-y: auto;">
                  {% for ai in intelligents %}
                    <div class="d-flex align-items-start mb-3">
                      <div class="review-user">
                        {% if ai.assigned_developer.profile_picture %}
                          <img src="{{ ai.assigned_developer.profile_picture.url }}" width="65" height="65" class="rounded-circle" alt="{{ ai.assigned_developer.full_name }}" />
                        {% else %}
                          <img src="{% static 'images/default-profile.png' %}" width="65" height="65" class="rounded-circle" alt="Sin foto"/>
                        {% endif %}
                      </div>
                      <div class="review-content ms-3">
                        <div class="d-flex align-items-center mb-2">
                          <h6 class="mb-0">{{ ai.name }}</h6>
                          {% if ai.requires_gpu %}
                            <span class="badge bg-danger ms-2">GPU</span>
                          {% endif %}
                        </div>
                        <small>Tipo AI: {{ ai.get_ai_type_display }}</small><br>
                        <div class="progress my-2" style="height: 7px;">
                          <div class="progress-bar {% if ai.progress == 100 %}bg-success{% else %}bg-warning{% endif %}" 
                               role="progressbar" style="width: {{ ai.progress }}%;" 
                               aria-valuenow="{{ ai.progress }}" aria-valuemin="0" aria-valuemax="100">
                          </div>
                        </div>
                        <small>Progreso: {{ ai.progress }}%</small>
                        {% if ai.model_accuracy %}
                          <br><small>Precisi√≥n: {{ ai.model_accuracy }}%</small>
                        {% endif %}
                        {% if ai.technical_notes %}
                          <p class="mt-1 text-muted">{{ ai.technical_notes|truncatewords:20 }}</p>
                        {% endif %}
                        {% if ai.final_url %}
                          <a href="{{ ai.final_url }}" target="_blank" class="btn btn-sm btn-primary mt-1">Ver Resultado</a>
                        {% endif %}
                      </div>
                    </div>
                    <hr/>
                  {% empty %}
                    <p class="text-muted">No hay modelos de Inteligencia Artificial asignados a este proyecto.</p>
                  {% endfor %}
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- BLOQUE LATERAL DE RESUMEN -->
        <div class="col-12 col-xl-4 d-flex">
          <div class="card radius-10 overflow-hidden w-100">
            <div class="card-body" style="background-color: rgb(46,46,46); border-radius:25px;">
              
              <div class="card radius-10 w-100 mb-3">
                <div class="card-body">
                  <h5 class="mb-2">Equipo Responsable de AI</h5>
                  <div class="d-flex gap-3 flex-wrap">
                    {% for ai in intelligents %}
                      {% if ai.assigned_developer %}
                        <div class="review-user text-center">
                          {% if ai.assigned_developer.profile_picture %}
                            <img src="{{ ai.assigned_developer.profile_picture.url }}" class="rounded-circle" width="65" height="65">
                          {% else %}
                            <img src="{% static 'images/default-profile.png' %}" class="rounded-circle" width="65" height="65">
                          {% endif %}
                          <p class="mb-0 fw-bold" style="font-size: 13px;">{{ ai.assigned_developer.full_name }}</p>
                          <p class="mb-0 text-muted" style="font-size: 9px;">{{ ai.assigned_developer.get_role_display }}</p>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              </div>

              <div class="card border shadow-none radius-10">
                <div class="card-body">
                  <h5 class="mb-2">Resumen</h5>
                  <p>Total Modelos AI: {{ total_intelligents }}</p>
                  <p>Completados: {{ completed_intelligents }}</p>
                  <p>En progreso: {{ total_intelligents|add:"-"|add:completed_intelligents }}</p>
                  <p>Progreso promedio: {{ average_intelligent_progress }}%</p>
                </div>
              </div>

            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>



