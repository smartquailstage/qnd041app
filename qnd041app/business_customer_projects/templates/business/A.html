{% load widget_tweaks %}
{% load static %}





<div class="tab-pane fade" id="tab-automatizacion" role="tabpanel">


          <hr class="my-4">
        <div class="card radius-10">
          <div class="card-body" >
    <div class="row">
          <div class="col-12 col-xl-8 d-flex">
            <div class="card radius-10 w-100">
              <div class="card-body" style="background-color: rgb(46, 46, 46);border-radius: 25px;">
                                                 <div class="country-icon">
                            <img src="assets/images/icons/india.png" alt="" width="32">
                          </div>


                      
                 <h5> Automatización (+A)</h5>

<div class="d-flex flex-column flex-lg-row align-items-lg-center align-self-end justify-content-lg-between border p-3 gap-3 mb-0 rounded-3">

    <!-- Total de automatizaciones -->
    <div class="d-flex align-items-center gap-3">
        <div class="widget-icon rounded-circle bg-light-success text-success">
            <i class="fadeIn animated bx bx-bot"></i>
        </div>
        <div>
            <h4 class="mb-0">{{ total_automations }}</h4>
            <p class="mb-0 text-secondary">Automatizaciones</p>
        </div>
    </div>

    <div class="vr d-none d-lg-block"></div>

    <!-- Integraciones a terceros -->
    <div class="d-flex align-items-center gap-3">
        <div class="widget-icon rounded-circle bg-light-success text-success">
            <ion-icon name="git-merge-outline"></ion-icon>
        </div>
        <div>
            <h4 class="mb-0">{{ total_integrations }}</h4>
            <p class="mb-0 text-secondary">Integraciones a Terceros (APIs)</p>
        </div>
    </div>

    <div class="vr d-none d-lg-block"></div>

    <!-- Completados -->
    <div class="d-flex align-items-center gap-3">
        <div class="widget-icon rounded-circle bg-light-success text-success">
            <ion-icon name="checkmark-done-outline"></ion-icon>
        </div>
        <div>
            <h4 class="mb-0">{{ completed_automations }}</h4>
            <p class="mb-0 text-secondary">Completados</p>
        </div>
    </div>

</div>

    

         
                 

               <div class="row g-4 align-items-center mb-4" >
                  <div class="col-12 col-xl-12" style="max-height: 300px; overflow-y: auto;margin-top: 79px;">

                         
{% for automation in automations %}
<div class="d-flex align-items-start mb-4">
     {% for member in staff %}
                                        <div class="review-user text-center">
                                            {% if member.profile_picture %}
                                                <img src="{{ member.profile_picture.url }}" width="65" height="65" class="rounded-circle" alt="{{ member.full_name }}">
                                            {% else %}
                                                <img src="{% static 'images/default-profile.png' %}" class="rounded-circle" width="65" height="65" alt="Sin foto">
                                            {% endif %}
                                            <p class="mb-0 fw-bold" style="font-size: 13px;">{{ member.full_name }}</p>
                                            <p class="mb-0 text-muted" style="font-size: 9px;">{{ member.get_role_display }}</p>
                                        </div>
                                        {% empty %}
                                            <p class="text-muted">No hay miembros asignados al proyecto.</p>
                                        {% endfor %}

    <div class="review-content ms-3">
        <!-- Barra de progreso -->
        <div class="progress mb-2" style="height:7px;">
            <div class="progress-bar progress-bar-striped bg-warning" 
                 role="progressbar" 
                 style="width: {{ automation.progress }}%" 
                 aria-valuenow="{{ automation.progress }}" aria-valuemin="0" aria-valuemax="100">
            </div>
        </div>

        <!-- Nombre y título -->
        <div class="d-flex align-items-center mb-2">
            <h6 class="mb-0">
                {{ automation.name }} {% if automation.title %}- {{ automation.title }}{% endif %}
                <ion-icon name="flash-outline" class="text-warning"></ion-icon>
                {% if automation.progress == 100 %}
                    <ion-icon name="checkmark-done-circle-outline" class="text-success"></ion-icon>
                {% else %}
                    <span class="spinner-border spinner-border-sm text-warning"></span>
                {% endif %}
            </h6>
        </div>

        <!-- Fechas -->
        <div class="d-flex align-items-center mb-2">
            <h6 class="mb-0">Inicio: {{ automation.start_date }} — Entrega: {{ automation.delivery_date }}</h6>
        </div>

        <!-- Descripción -->
        <p>{{ automation.description }}</p>

        <!-- Información adicional -->
        <div class="mt-2">
            <small class="text-muted">
                Categoría: {{ automation.automation_category }} — 
                Tipo: {{ automation.automation_type }} — 
                Microservicio: {{ automation.microservice_type }} — 
                Integración a terceros: {{ automation.integration_type }}
            </small>
        </div>

        <!-- Estado de aprobación -->
        <div class="mt-1">
            {% if automation.approved_by_client %}
                <span class="badge bg-success">Aprobado por cliente</span>
            {% else %}
                <span class="badge bg-warning text-dark">Pendiente de aprobación</span>
            {% endif %}
        </div>

        <!-- URL final -->
        {% if automation.final_url %}
            <p class="mt-2"><a href="{{ automation.final_url }}" target="_blank">Ver URL final</a></p>
        {% endif %}
    </div>
</div>
{% empty %}
<p>No hay automatizaciones registradas.</p>
{% endfor %}




                                <hr/>

                          
                  </div>

               </div><!--end row-->

              </div>
            </div>
          </div>
          <div class="col-12 col-xl-4 d-flex">

            
            
            <div class="card radius-10 overflow-hidden w-100">
              <div class="card-body" style="background-color: rgb(46, 46, 46);border-radius: 25px;">

                            <div class="card radius-10 w-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <h5 class="mb-0">Equipo SmartQuail Responsable</h5>
                                    </div>

                                    <!-- CONTENEDOR HORIZONTAL -->
                                    <div class="d-flex gap-4 flex-wrap">
                                        {% for member in staff %}
                                        <div class="review-user text-center">
                                            {% if member.profile_picture %}
                                                <img src="{{ member.profile_picture.url }}" width="65" height="65" class="rounded-circle" alt="{{ member.full_name }}">
                                            {% else %}
                                                <img src="{% static 'images/default-profile.png' %}" class="rounded-circle" width="65" height="65" alt="Sin foto">
                                            {% endif %}
                                            <p class="mb-0 fw-bold" style="font-size: 13px;">{{ member.full_name }}</p>
                                            <p class="mb-0 text-muted" style="font-size: 9px;">{{ member.get_role_display }}</p>
                                        </div>
                                        {% empty %}
                                            <p class="text-muted">No hay miembros asignados al proyecto.</p>
                                        {% endfor %}
                                    </div>
                                    <!-- FIN CONTENEDOR HORIZONTAL -->

                                </div>
                            </div>


              {% for automation in automations %}
<div class="d-flex flex-column gap-3">

    <!-- TARJETA PRINCIPAL DE AUTOMATIZACIÓN -->
    <div class="card border shadow-none radius-10 flex-grow-1 mb-0">
        <div class="card-body">

            <!-- Título y categoría -->
            <div class="d-flex align-items-start gap-2">
                <div>
                    <h5 class="mb-0">{{ automation.automation_category|default:"Categoría desconocida" }}</h5>
                </div>
                <div class="ms-auto widget-icon-2 bg-light-success text-success rounded-circle">
                    <ion-icon name="speedometer-outline"></ion-icon>
                </div>
            </div>

            <!-- Tipo de automatización -->
            <div class="mt-2">
                <h3 class="mb-2">{{ automation.automation_type|default:"Tipo desconocido" }}</h3>
                <p>{{ automation.description }}</p>

                <div class="d-flex align-items-center gap-2">
                    <!-- Indicador de integración -->
                    {% if automation.integration_type %}
                        <div class="widget-icon-small bg-light-danger text-danger">
                            +{{ automation.integration_type|title }}
                        </div>
                    {% endif %}

                    <!-- Barra de progreso -->
                    <div class="progress flex-grow-1" style="height: 5px;">
                        <div class="progress-bar bg-gradient-info" role="progressbar" 
                             style="width: {{ automation.progress }}%;" 
                             aria-valuenow="{{ automation.progress }}" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- TARJETA DE MICROSERVICIO / RECURSOS -->
    <div class="card border shadow-none radius-10 mb-0">
        <div class="card-body">

            <div class="d-flex align-items-start gap-2">
                <div>
                    <h5 class="mb-0">Microservicio</h5>
                </div>
                <div class="ms-auto widget-icon-2 bg-light-success text-success rounded-circle">
                    <ion-icon name="hardware-chip-outline"></ion-icon>
                </div>
            </div>

            <div class="mt-2">
                <h3 class="mb-2">{{ automation.microservice_type|default:"No definido" }}</h3>
                <p>Progreso: {{ automation.progress }}%</p>

                <div class="d-flex align-items-center gap-2">
                    <!-- AI o indicador adicional -->
                    {% if automation.automation_type in "ai" %}
                        <div class="widget-icon-small bg-light-warning text-warning">
                            +AI
                        </div>
                    {% endif %}

                    <!-- Barra de progreso -->
                    <div class="progress flex-grow-1" style="height: 5px;">
                        <div class="progress-bar bg-gradient-info" role="progressbar" 
                             style="width: {{ automation.progress }}%;" 
                             aria-valuenow="{{ automation.progress }}" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>

            {% if automation.final_url %}
                <div class="mt-2">
                    <a href="{{ automation.final_url }}" target="_blank">Ver URL final</a>
                </div>
            {% endif %}

        </div>
    </div>

</div>
{% empty %}
<p>No hay automatizaciones registradas.</p>
{% endfor %}

              </div>
            </div>
          </div>
        </div>

            <hr class="my-4">
          </div>
        </div>    
</div>
