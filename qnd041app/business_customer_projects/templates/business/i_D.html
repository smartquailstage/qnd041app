{% load widget_tweaks %}
{% load static %}

<div class="tab-pane fade" id="tab-desarrollo" role="tabpanel">

    <hr class="my-4">
    <div class="card radius-10">
        <div class="card-body">
            <div class="row">
                <!-- IZQUIERDA: Procesos -->
                <div class="col-12 col-xl-8 d-flex">
                    <div class="card radius-10 w-100">
                        <div class="card-body" style="background-color: rgb(46, 46, 46); border-radius: 25px;">
                            
                            <div class="country-icon mb-3">
                                <img src="assets/images/icons/india.png" alt="" width="32">
                            </div>

                            <h5>Investigación y Desarrollo: {{ project.name }}</h5>

                            <!-- TARJETAS DE ESTADÍSTICAS -->
<div class="d-flex flex-column flex-lg-row align-items-lg-center align-self-end justify-content-lg-between border p-3 gap-3 mb-0 rounded-3">

    <!-- Total Procesos -->
    <div class="d-flex align-items-center gap-3">
        <div class="widget-icon rounded-circle bg-light-success text-success">
             <ion-icon name="create-outline"></ion-icon>
        </div>
        <div>
            <h4 class="mb-0">{{ total_processes }}</h4>
            <p class="mb-0 text-secondary">Total Procesos</p>
        </div>
    </div>

    <div class="vr d-none d-lg-block"></div>

    <!-- En Desarrollo -->
    <div class="d-flex align-items-center gap-3">
        <div class="widget-icon rounded-circle bg-light-success text-success">
            <ion-icon name="code-slash-outline"></ion-icon>
        </div>
        <div>
            <h4 class="mb-0">{{ in_progress_processes }}</h4>
            <p class="mb-0 text-secondary"> Total I+D ({{ average_progress|default:"0" }}%)</p>
        </div>
    </div>

    <div class="vr d-none d-lg-block"></div>

    <!-- Completados -->
    <div class="d-flex align-items-center gap-3">
        <div class="widget-icon rounded-circle bg-light-success text-success">
            <ion-icon name="checkmark-done-outline"></ion-icon>
        </div>
        <div>
            <h4 class="mb-0">{{ completed_processes }}</h4>
            <p class="mb-0 text-secondary">Completados</p>
        </div>
    </div>

</div>

                            <!-- LISTA DE PROCESOS -->
                            <div class="row g-4 align-items-center mb-4">
                                <div class="col-12 col-xl-12" style="max-height: 300px; overflow-y: auto; margin-top: 79px;">
                                    {% for member in staff %}
                                        {% for process in member.assigned_processes.all %}
                                        <div class="d-flex align-items-start mb-3">

                                            <!-- Foto del miembro -->
                                            <div class="review-user">
                                                {% if member.profile_picture %}
                                                    <img src="{{ member.profile_picture.url }}" class="rounded-circle" width="60" height="60" alt="{{ member.full_name }}">
                                                {% else %}
                                                    <img src="{% static 'images/default-profile.png' %}" class="rounded-circle" width="60" height="60" alt="Sin foto">
                                                {% endif %}
                                            </div>

                                            <!-- Contenido del proceso -->
                                            <div class="review-content ms-3 flex-grow-1">

                                                <!-- Barra de progreso -->
                                                <div class="progress mb-2" style="height:7px;">
                                                    <div class="progress-bar progress-bar-striped bg-warning" role="progressbar"
                                                         style="width: {{ process.progress }}%" aria-valuenow="{{ process.progress }}" aria-valuemin="0" aria-valuemax="100">
                                                    </div>
                                                </div>

                                                                                              <div class="d-flex align-items-center mb-1">
                                                    <h6 class="mb-0">{{ process.process_event }}</h6>
                                                </div>

                                                <div class="d-flex align-items-center mb-1">
                                                  
                                                    <h6 class="mb-0"><ion-icon name="create-outline"></ion-icon> 
                                                      {{ process.name }} 
                                                      (<ion-icon name="hourglass-outline"></ion-icon> {{ process.total_development_days }} días,  <ion-icon name="code-slash-outline"></ion-icon>{{ process.progress|default:"0"  }}%)
                                                        
                                                    </h6>
                                                  {% if process.final_url %}
                                                     <p class="mb-0 ms-auto text-success bg-light-success px-2 rounded py-1" style="font-size: 7px;"><a href="{{ porcess.final_url }}"><ion-icon name="eye-outline"></ion-icon> Ver en vivo</a></p>
                                                     {% else %}
                                                      <p class="mb-0 ms-auto text-danger bg-light-danger px-2 rounded py-1"><ion-icon name="eye-off-outline"></ion-icon> No disponible</p>
                                                      {% endif %}

                                                        {% if process.progress == 100 %}
                                                        <ion-icon name="checkmark-done-circle-outline" class="text-success"></ion-icon>
                                                            
                                                        {% else %}
                                                            <span class="spinner-border spinner-border-sm text-warning"></span>
                                                        {% endif %} 
                                                </div>

                                                <div class="d-flex align-items-center mb-1">
                                                    <h6 class="mb-0">Fecha de creación:</h6>
                                                    <p class="mb-0 ms-2">{{ process.start_date|date:"d/m/Y" }}</p>
                                                </div>


                                                <div class="d-flex align-items-center mb-1">
                                                    <h6 class="mb-0">Estado:</h6>
                                                    <p class="mb-0 ms-2"> {{ process.process_class }} </p>
                                                </div>

                                              <div class="d-flex align-items-center mb-1">
                                                    <h6 class="mb-0">Tipo de proceso:</h6>
                                                    <p class="mb-0 ms-2"> {{ process.process_type }}</p>
                                                </div>




                                                <div class="d-flex align-items-center mb-1">
                                                    <h6 class="mb-0">
                                                        {% if process.has_automation %}
                                                        <i class="fadeIn animated bx bx-bot"></i>
                                                        {{ process.automation_description}}
                                                            
                                                        {% endif %}
                                                    </h6>
                                                </div>

                                                  <div class="d-flex align-items-center mb-1">

                                                    <h6 class="mb-0">
       
                                                        {% if process.has_ai %}
                                                         <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-cpu"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
                                                         {{ process.ai_model_description }}
                                                           
                                                        {% endif %}
                                                    </h6>


                                                </div>


                                                <p>{{ process.description|default:"Sin descripción" }}  (<ion-icon name="speedometer-outline"></ion-icon> % {{ process.memory_percent_used }} / <ion-icon name="hardware-chip-outline"></ion-icon> % {{ process.cpu_percent_used }} )</p>
                                            </div>
                                        </div>
                                        <hr/>
                                        {% endfor %}
                                    {% empty %}
                                        <p>No hay miembros del staff o procesos asignados.</p>
                                    {% endfor %}
                                </div>
                            </div><!-- end row -->

                        </div>
                    </div>
                </div>

                <!-- DERECHA: Staff -->
                <div class="col-12 col-xl-4 d-flex">
                    <div class="card radius-10 overflow-hidden w-100">
                        <div class="card-body" style="background-color: rgb(46, 46, 46); border-radius: 25px;">

                            <div class="card radius-10 w-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <h5 class="mb-0">Equipo SmartQuail Responsable</h5>
                                    </div>

                                    <!-- CONTENEDOR HORIZONTAL -->
                                    <div class="d-flex gap-4 flex-wrap">
                                        {% for member in staff %}
                                        <div class="review-user text-center">
                                            {% if member.profile_picture %}
                                                <img src="{{ member.profile_picture.url }}" width="65" height="65" class="rounded-circle" alt="{{ member.full_name }}">
                                            {% else %}
                                                <img src="{% static 'images/default-profile.png' %}" class="rounded-circle" width="65" height="65" alt="Sin foto">
                                            {% endif %}
                                            <p class="mb-0 fw-bold" style="font-size: 13px;">{{ member.full_name }}</p>
                                            <p class="mb-0 text-muted" style="font-size: 9px;">{{ member.get_role_display }}</p>
                                        </div>
                                        {% empty %}
                                            <p class="text-muted">No hay miembros asignados al proyecto.</p>
                                        {% endfor %}
                                    </div>
                                    <!-- FIN CONTENEDOR HORIZONTAL -->

                                </div>
                            </div>
<div class="d-flex flex-column gap-3">

  <!-- Memoria RAM -->
<div class="d-flex flex-column gap-3">

  <!-- Memoria RAM -->
  <div class="card border shadow-none radius-10 flex-grow-1 mb-0">
    <div class="card-body">
      <div class="d-flex align-items-start gap-2">
        <div>
          <h5 class="mb-0">Uso de Memoria RAM</h5>
        </div>
        <div class="ms-auto widget-icon-2 bg-light-success text-success rounded-circle">
          <ion-icon name="speedometer-outline"></ion-icon>
        </div>
      </div>
      <div>
        <h3 class="mb-2">{{ project.memoria_total }} MB</h3>
        <p>Utilizados ({{ total_percent_memory_used }}%)</p>
        <div class="d-flex align-items-center gap-2">
          {% if total_percent_memory_used < 60 %}
            <div class="widget-icon-small bg-light-success text-success"> 
              <ion-icon name="cloud-done-outline"></ion-icon>
            </div>
            <p class="mb-0 ms-auto text-success bg-light-success px-2 rounded py-1">
              Recursos disponibles
            </p>
          {% else %}
            <div class="widget-icon-small bg-light-success text-success">
              <ion-icon name="cloud-offline-outline"></ion-icon>
            </div>
            <p class="mb-0 ms-auto text-success bg-light-success px-2 rounded py-1">
              Recursos límite críticos
            </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Procesamiento -->
  <div class="card border shadow-none radius-10 mb-0">
    <div class="card-body">
      <div class="d-flex align-items-start gap-2">
        <div>
          <h5 class="mb-0">Uso de Procesamiento</h5>
        </div>
        <div class="ms-auto widget-icon-2 bg-light-success text-success rounded-circle">
          <ion-icon name="hardware-chip-outline"></ion-icon>
        </div>
      </div>
      <div>
        <h3 class="mb-2">{{ project.procesamiento_total_aproximado_millicore }} Cores</h3>
        <p>Utilizados ({{ total_percent_cpu_used }}%)</p>
        <div class="d-flex align-items-center gap-2">
          {% if total_percent_cpu_used < 60 %}
            <div class="widget-icon-small bg-light-success text-success"> 
              <ion-icon name="cloud-done-outline"></ion-icon>
            </div>
            <p class="mb-0 ms-auto text-success bg-light-success px-2 rounded py-1">
              Recursos disponibles
            </p>
          {% else %}
            <div class="widget-icon-small bg-light-success text-success">
              <ion-icon name="cloud-offline-outline"></ion-icon>
            </div>
            <p class="mb-0 ms-auto text-success bg-light-success px-2 rounded py-1">
              Recursos límite críticos
            </p>
          {% endif %}
        </div>
      </div>
      <div id="chart4"></div>
    </div>
  </div>

</div>


</div>


                        </div>
                    </div>
                </div>
            </div>

            <hr class="my-4">
        </div>
    </div>
</div>
