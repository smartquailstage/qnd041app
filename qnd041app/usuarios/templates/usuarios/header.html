
{% load widget_tweaks %}
{% load static %}




<style>


.ticker-container {
  background: #444040;
  border-radius: 8px;
  padding: 20px;
  width: 900px;
  height: 46px;
  overflow-y: scroll;
  scroll-behavior: smooth;
  margin-bottom: -24px;
  }

    /* ðŸ”’ Ocultar scrollbar (compatible cross-browser) */
  .ticker-container::-webkit-scrollbar {
    width: 0;
    height: 0;
  }
  .ticker-container {
    -ms-overflow-style: none;  /* IE y Edge */
    scrollbar-width: none;     /* Firefox */
  }

  .line {
    opacity: 0;
    white-space: pre-line;
    margin: 4px 0;
    transform: translateX(80px); /* empieza desplazada a la derecha */
    transition: all 0.4s ease-out;
  }

  .line.visible {
    opacity: 1;
    transform: translateX(0);
  }

  .cursor {
    display: inline-block;
    width: 8px;
    background-color: #fff;
    animation: blink 0.8s infinite;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Colores segÃºn tipo de log */
  .info  { color: #717a7b; }
  .warn  { color: #ffcc00; }
  .error { color: #ff4444; }
</style>





<header class="top-header">
  <nav class="navbar navbar-expand gap-3">
    <div class="toggle-icon">
      <ion-icon name="menu-outline"></ion-icon>




    </div>

<div class="ticker-container" id="ticker">
  <div class="line"><span class="cursor"></span></div>
</div>

  
    <div class="top-navbar-right ms-auto">

      <ul class="navbar-nav align-items-center">

 

<li class="nav-item dropdown dropdown-large">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
    <div class="position-relative">
      {% if upload_fields %}
        <span class="notify-badge">{{ upload_fields|length }}</span>
      {% endif %}
      <ion-icon name="stats-chart-outline"></ion-icon>
    </div>
  </a>

  <div class="dropdown-menu dropdown-menu-end">
    <div class="msg-header d-flex align-items-center">
      <p class="msg-header-title mb-0">
       <ion-icon name="ticket-outline"></ion-icon>Documentos del Perfil
      </p>
      <p class="msg-header-clear ms-auto mb-0 text-primary" style="cursor: pointer;">
        {{ upload_fields|length }} campos
      </p>
    </div>

    <div class="header-notifications-list">
      {% for nombre_campo, url in upload_fields.items %}
        <a class="dropdown-item" href="{{ url|default:'#' }}" {% if url %}target="_blank"{% endif %}>
          <div class="d-flex align-items-center">
            <div class="notify {% if url %}text-success{% else %}text-danger{% endif %}">
              <ion-icon name="{% if url %}cloud-done{% else %}cloud-upload{% endif %}-outline"></ion-icon>
            </div>
            <div class="flex-grow-1">
              <h6 class="msg-name">
                {{ nombre_campo }}
                <span class="msg-time float-end">
                  {% if url %}Subido{% else %}Pendiente{% endif %}
                </span>
              </h6>
              <p class="msg-info">
                {% if url %}Ver archivo{% else %}No hay archivo cargado{% endif %}
              </p>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="dropdown-item text-center text-muted small">
          No hay archivos en el perfil
        </div>
      {% endfor %}
    </div>
    <div class="text-center msg-footer">
       <a href="{% url 'usuarios:vista_certificados' %}"> <ion-icon name="folder-open-outline"></ion-icon> Documentos del perfil</a>
     
    </div>
  </div>
</li>




<li class="nav-item dropdown dropdown-large">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
    <div class="position-relative">
      {% if cart|length > 0 %}
        <span class="notify-badge">{{ cart|length }}</span>
      {% endif %}
      <ion-icon name="cart-outline"></ion-icon>
    </div>
  </a>

  <div class="dropdown-menu dropdown-menu-end">
    <div class="msg-header d-flex align-items-center">
      <p class="msg-header-title mb-0">
        <ion-icon name="cart-outline"></ion-icon> Carrito de Compras
      </p>
      <p class="msg-header-clear ms-auto mb-0 text-primary">
        {{ cart|length }} productos
      </p>
    </div>

    <div class="header-notifications-list">
      {% for item in cart %}
        <a class="dropdown-item" href="{{ item.product.get_absolute_url }}">
          <div class="d-flex align-items-center">
            <div class="notify text-success">
              <ion-icon name="cube-outline"></ion-icon>
            </div>
            <div class="flex-grow-1">
              <h6 class="msg-name">{{ item.product.name }}</h6>
              <p class="msg-info">
                Cantidad: {{ item.quantity }} &nbsp; â€” &nbsp;
                Total: ${{ item.total_price }}
              </p>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="dropdown-item text-center text-muted small">
          Tu carrito estÃ¡ vacÃ­o
        </div>
      {% endfor %}
    </div>

    <div class="text-center msg-footer">
      <p class="mb-1">
        <strong>Total:</strong> ${{ cart.get_total_price }}
      </p>
      <a href="{% url 'saas_cart:cart_detail' %}" class="btn btn-primary btn-sm mt-1">
        <ion-icon name="eye-outline"></ion-icon> Ver Carrito
      </a>
    </div>
  </div>
</li>


<li class="nav-item dropdown dropdown-user-setting">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
    <div class="user-setting ">
      {% if profile_photo %}
        <img src="{{ profile_photo }}" class="user-img" alt="Foto de perfil">
          {% else %}
       <img src="{% static 'assets/images/login_bg/Sello2.png' %}" style="width:30px;" alt="Default Photo">
      {% endif %}
    

  

    </div>
  </a>
  <ul class="dropdown-menu dropdown-menu-end">
    <li>
      <a class="dropdown-item" href="{% url 'usuarios:perfil' %}">
        <div class="d-flex  flex-row  align-items-center gap-2">
    
            <img src="{% static 'assets/images/login_bg/Sello2.png' %}" alt="Foto de perfil" class="rounded-circle" width="44" height="44">
     
          <div class="">
            <h6 class="mb-0 dropdown-user-name">{{ name }} {{ last_name }}</h6>
            <small class="mb-0 dropdown-user-designation text-secondary">Paciente MEDDESÂ®</small>
          </div>
        </div>
      </a>
    </li>

    <li><hr class="dropdown-divider"></li>
    <li>
      <a class="dropdown-item" href="{% url 'usuarios:logout' %}">
        <div class="d-flex align-items-center">
          <div><ion-icon name="log-out-outline"></ion-icon></div>
          <div class="ms-3"><span>Salir</span></div>
        </div>
      </a>
    </li>
  </ul>
</li>


      </ul>

    </div>
  </nav>
</header>


<script>
const logs = [
  "root@smartquail:~# initializing SmartQuailÂ® CyberOps Console v4.8.1",
  "[BOOT] System integrity verified. All modules signed and trusted.",
  "[NETWORK] Establishing secure VPN tunnel to cloud node us-east-1...",
  "[VPN] AES-256 tunnel established with SmartQuail CloudHub (latency: 28ms)",
  "root@smartquail:~# nmap -A -T4 10.0.0.0/24",
  "[SCANNER] Enumerating hosts... 18 nodes found active.",
  "10.0.0.15 - open ports: 22(SSH), 8080(API), 443(HTTPS)",
  "10.0.0.19 - open ports: 21(FTP), 1433(MSSQL), 8000(NodeJS)",
  "[INFO] Performing banner grab for host 10.0.0.19:8080",
  "[RESULT] Server: nginx/1.24.2 | Framework: ExpressJS v4.19",
  "root@smartquail:~# ssh devops@10.0.0.15",
  "Authentication successful. Session key: SHA256:e3a7f...8a1c",
  "[SYSTEM] Ubuntu 24.04 LTS | Kernel 6.10.0 | Node v22.1.0",
  "[PROCESS] Docker containers detected: 14 active | 3 paused",
  "root@10.0.0.15:/# docker ps --format 'table {{.Names}}\t{{.Status}}'",
  "api-gateway          Up 12 hours",
  "auth-service         Up 12 hours",
  "ml-defense-engine    Up 2 hours (auto-restart)",
  "root@10.0.0.15:/# ./deploy_scaler.sh --region=us-west-2 --nodes=30",
  "[CLOUD] Auto-scaling SmartQuail cluster... Target nodes: 30",
  "[INFO] QND0210239 SmartQuail Node provisioning in progress...",
  "[CLOUD] Instance i-0afc8b93d created. (type: t3.large)",
  "[CLOUD] Load balancer updated successfully.",
  "[SECURITY] IDS signature update: CVE-2025-1093 mitigation applied.",
  "[AI-SEC] Neural Defender scanning runtime traffic patterns...",
  "[AI-SEC] Detected abnormal pattern in container: ml-defense-engine",
  "[THREAT] Possible reverse shell attempt from IP 203.0.113.77",
  "root@10.0.0.15:/# netstat -antp | grep 203.0.113.77",
  "[ANALYSIS] Suspicious connection confirmed: python3 (PID 9921)",
  "root@10.0.0.15:/# kill -9 9921",
  "[ACTION] Malicious process terminated successfully.",
  "root@10.0.0.15:/# ufw deny from 203.0.113.77",
  "[FIREWALL] Rule added. IP permanently blacklisted.",
  "root@10.0.0.15:/# systemctl restart smartquail-defense",
  "[INFO] SmartQuail Defense restarted and operational",
  "root@10.0.0.15:/# ./audit_cloud.sh --region=all",
  "[CLOUD AUDIT] Verifying IAM roles, policies, and bucket access...",
  "[RESULT] No misconfigurations found. All S3 buckets encrypted.",
  "root@10.0.0.15:/# tail -f /var/log/cloud/metrics.log",
  "[METRICS] CPU Load: 0.42 | RAM: 58% | Net TX/RX: 122MB / 109MB",
  "[METRICS] AI Defense Latency: 8.3ms | Detection Accuracy: 99.1%",
  "[SUCCESS] All systems operational â€” SmartQuail CloudSec stable ðŸ›°ï¸",
  "root@smartquail:~# exit",
  "[SESSION] Secure connection closed. Logs archived to /var/log/cyberops_2025_11_10.log",
  "root@smartquail:~# python train_model.py --dataset=imagenet --epochs=5",
  "[TENSORFLOW] Initializing GPU devices...",
  "[TENSORFLOW] Loaded dataset: 1.2M images | Classes: 1000",
  "[TENSORFLOW] Epoch 1/5 - Loss: 2.45 - Accuracy: 15.3%",
  "[TENSORFLOW] Epoch 2/5 - Loss: 1.98 - Accuracy: 36.7%",
  "[TENSORFLOW] Epoch 3/5 - Loss: 1.72 - Accuracy: 49.5%",
  "[TENSORFLOW] Epoch 4/5 - Loss: 1.50 - Accuracy: 58.2%",
  "[TENSORFLOW] Epoch 5/5 - Loss: 1.31 - Accuracy: 65.4%",
  "[TENSORFLOW] Model training completed âœ… | Saved: /models/resnet50_v2.h5",
  "root@smartquail:~# python eval_model.py --model=/models/resnet50_v2.h5",
  "[TENSORFLOW] Evaluating model on test dataset...",
  "[RESULT] Test Accuracy: 64.8% | F1 Score: 0.63 | Precision: 0.65",
  "root@smartquail:~# elasticsearch --cluster-name smartquail-cluster",
  "[ELASTICSEARCH] Cluster health: GREEN | Nodes: 5 | Shards: 15",
  "[ELASTICSEARCH] Index 'logs-2025-11' created successfully",
  "[ELASTICSEARCH] Bulk importing logs from /data/logs/2025-11/",
  "[ELASTICSEARCH] 100000 documents indexed | Took: 12.3s",
  "[ELASTICSEARCH] Searching: GET logs-2025-11/_search { 'query': { 'match_all': {} } }",
  "[ELASTICSEARCH] Returned 10000 hits | Max score: 1.0",
  "[CLOUD] Auto-scaling TensorFlow GPU nodes... Target: 4 nodes",
  "[CLOUD] GPU Node 3 launched (Tesla T4) | Status: Ready",
  "[CLOUD] GPU Node 4 launched (Tesla T4) | Status: Ready",
  "[AI-SEC] Monitoring TensorFlow processes for anomalous behavior...",
  "[AI-SEC] No anomalies detected | All processes stable",
  "[METRICS] GPU Utilization: 78% | Memory Usage: 12.4GB / 16GB",
  "[METRICS] ElasticSearch Queries/sec: 320 | Avg Latency: 12ms",
  "root@smartquail:~# python deploy_model.py --model=/models/resnet50_v2.h5 --target=cloud",
  "[DEPLOY] Uploading model to cloud storage...",
  "[DEPLOY] Model available at: https://cloud.smartquail.com/models/resnet50_v2.h5",
  "[DEPLOY] Model deployed to TensorFlow Serving | Status: RUNNING âœ…",
  "root@smartquail:~# exit",
  "[SESSION] Secure session closed. Logs archived to /var/log/cyberops_2025_11_10.log"
];

const container = document.getElementById('ticker');
const typingSpeed = 15; // velocidad de escritura (ms por letra)
const linePause = 400;  // pausa entre lÃ­neas
let currentLog = 0;
let charIndex = 0;
let cursor = document.querySelector('.cursor');
let currentLine = container.querySelector('.line');

function getLogClass(log) {
  if (log.includes('ERROR')) return 'error';
  if (log.includes('WARN')) return 'warn';
  return 'info';
}

function typeLogs() {
  if (currentLog >= logs.length) {
    // Reset para repetir en loop
    currentLog = 0;
    charIndex = 0;
    container.innerHTML = '<div class="line"><span class="cursor"></span></div>';
    currentLine = container.querySelector('.line');
  }

  const logText = logs[currentLog];
  const logClass = getLogClass(logText);

  if (charIndex === 0) {
    currentLine.classList.add(logClass, 'visible');
  }

  currentLine.textContent = logText.slice(0, charIndex + 1);
  currentLine.appendChild(cursor);

  container.scrollTop = container.scrollHeight;

  charIndex++;

  if (charIndex < logText.length) {
    setTimeout(typeLogs, typingSpeed);
  } else {
    currentLog++;
    charIndex = 0;
    setTimeout(() => {
      const newLine = document.createElement('div');
      newLine.className = 'line';
      container.appendChild(newLine);
      setTimeout(() => newLine.classList.add('visible'), 50);
      currentLine = newLine;
      typeLogs();
    }, linePause);
  }
}

// iniciar animaciÃ³n
typeLogs();
</script>
      <!--end top header-->